{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///D:/documents/dev/petehome/apps/web/lib/supabase/client.ts"],"sourcesContent":["/**\r\n * Supabase Client\r\n * Initializes and exports Supabase clients for the application\r\n */\r\n\r\nimport { createClient, SupabaseClient } from '@supabase/supabase-js'\r\nimport type { Database } from './types'\r\n\r\n// Environment variables\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n/**\r\n * Check if a string is a valid HTTP/HTTPS URL\r\n */\r\nfunction isValidUrl(urlString: string | undefined): boolean {\r\n  if (!urlString) return false\r\n  try {\r\n    const url = new URL(urlString)\r\n    return url.protocol === 'http:' || url.protocol === 'https:'\r\n  } catch {\r\n    return false\r\n  }\r\n}\r\n\r\n/**\r\n * Check if Supabase is properly configured with valid credentials\r\n */\r\nexport function isSupabaseConfigured(): boolean {\r\n  // Check that URL exists and is a valid HTTP/HTTPS URL\r\n  if (!isValidUrl(supabaseUrl)) return false\r\n  // Check that anon key exists and isn't a placeholder\r\n  if (!supabaseAnonKey || supabaseAnonKey.includes('your-') || supabaseAnonKey.length < 20) return false\r\n  return true\r\n}\r\n\r\n/**\r\n * Check if service role key is available and valid (for writes)\r\n */\r\nexport function hasServiceRoleKey(): boolean {\r\n  if (!supabaseServiceKey) return false\r\n  // Check it's not a placeholder\r\n  if (supabaseServiceKey.includes('your-') || supabaseServiceKey.length < 20) return false\r\n  return true\r\n}\r\n\r\n// Singleton instances\r\nlet anonClient: SupabaseClient<Database> | null = null\r\nlet serviceClient: SupabaseClient<Database> | null = null\r\n\r\n/**\r\n * Get the public Supabase client (anon key)\r\n * Use this for read operations and client-side queries\r\n * Returns null if not configured (call isSupabaseConfigured() first)\r\n */\r\nexport function getSupabaseClient(): SupabaseClient<Database> | null {\r\n  if (!isSupabaseConfigured()) {\r\n    return null\r\n  }\r\n\r\n  if (!anonClient) {\r\n    try {\r\n      anonClient = createClient<Database>(supabaseUrl!, supabaseAnonKey!, {\r\n        auth: {\r\n          persistSession: false,\r\n          autoRefreshToken: false,\r\n        },\r\n      })\r\n    } catch {\r\n      return null\r\n    }\r\n  }\r\n\r\n  return anonClient\r\n}\r\n\r\n/**\r\n * Get the service role Supabase client\r\n * Use this for server-side write operations (local mode only)\r\n * Returns null if not configured\r\n * WARNING: Never expose this in client-side code\r\n */\r\nexport function getSupabaseServiceClient(): SupabaseClient<Database> | null {\r\n  if (!isSupabaseConfigured()) {\r\n    return null\r\n  }\r\n\r\n  if (!hasServiceRoleKey()) {\r\n    return null\r\n  }\r\n\r\n  if (!serviceClient) {\r\n    try {\r\n      serviceClient = createClient<Database>(supabaseUrl!, supabaseServiceKey!, {\r\n        auth: {\r\n          persistSession: false,\r\n          autoRefreshToken: false,\r\n        },\r\n      })\r\n    } catch {\r\n      return null\r\n    }\r\n  }\r\n\r\n  return serviceClient\r\n}\r\n\r\n/**\r\n * Get the appropriate client based on operation type\r\n * - For reads: use anon client\r\n * - For writes: use service client (if available) or anon client\r\n * Returns null if Supabase is not configured\r\n */\r\nexport function getSupabaseClientForOperation(operation: 'read' | 'write'): SupabaseClient<Database> | null {\r\n  if (operation === 'write' && hasServiceRoleKey()) {\r\n    return getSupabaseServiceClient()\r\n  }\r\n  return getSupabaseClient()\r\n}\r\n\r\n// Export types for convenience\r\nexport type { Database }\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;CAGC,GAED;;AAGA,wBAAwB;AACxB,MAAM;AACN,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAEhE;;CAEC,GACD,SAAS,WAAW,SAA6B;IAC/C,IAAI,CAAC,WAAW,OAAO;IACvB,IAAI;QACF,MAAM,MAAM,IAAI,IAAI;QACpB,OAAO,IAAI,QAAQ,KAAK,WAAW,IAAI,QAAQ,KAAK;IACtD,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAKO,SAAS;IACd,sDAAsD;IACtD,IAAI,CAAC,WAAW,cAAc,OAAO;IACrC,qDAAqD;IACrD,IAAI,CAAC,mBAAmB,gBAAgB,QAAQ,CAAC,YAAY,gBAAgB,MAAM,GAAG,IAAI,OAAO;IACjG,OAAO;AACT;AAKO,SAAS;IACd,IAAI,CAAC,oBAAoB,OAAO;IAChC,+BAA+B;IAC/B,IAAI,mBAAmB,QAAQ,CAAC,YAAY,mBAAmB,MAAM,GAAG,IAAI,OAAO;IACnF,OAAO;AACT;AAEA,sBAAsB;AACtB,IAAI,aAA8C;AAClD,IAAI,gBAAiD;AAO9C,SAAS;IACd,IAAI,CAAC,wBAAwB;QAC3B,OAAO;IACT;IAEA,IAAI,CAAC,YAAY;QACf,IAAI;YACF,aAAa,IAAA,gMAAY,EAAW,aAAc,iBAAkB;gBAClE,MAAM;oBACJ,gBAAgB;oBAChB,kBAAkB;gBACpB;YACF;QACF,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,OAAO;AACT;AAQO,SAAS;IACd,IAAI,CAAC,wBAAwB;QAC3B,OAAO;IACT;IAEA,IAAI,CAAC,qBAAqB;QACxB,OAAO;IACT;IAEA,IAAI,CAAC,eAAe;QAClB,IAAI;YACF,gBAAgB,IAAA,gMAAY,EAAW,aAAc,oBAAqB;gBACxE,MAAM;oBACJ,gBAAgB;oBAChB,kBAAkB;gBACpB;YACF;QACF,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,OAAO;AACT;AAQO,SAAS,8BAA8B,SAA2B;IACvE,IAAI,cAAc,WAAW,qBAAqB;QAChD,OAAO;IACT;IACA,OAAO;AACT"}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///D:/documents/dev/petehome/apps/web/lib/services/settings.service.ts"],"sourcesContent":["/**\r\n * Settings Service\r\n * Handles fetching and updating application settings from Supabase\r\n */\r\n\r\nimport { getSupabaseClientForOperation } from '@/lib/supabase/client'\r\n\r\nexport interface AppSettings {\r\n  id: string\r\n  rounded_layout: boolean\r\n  theme: 'light' | 'dark' | 'system'\r\n  brand_color: 'purple' | 'blue' | 'teal' | 'orange' | 'pink' | 'yellow'\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\nexport type AppSettingsUpdate = Partial<\r\n  Pick<AppSettings, 'rounded_layout' | 'theme' | 'brand_color'>\r\n>\r\n\r\n// Default settings to use when DB is not available or no settings exist\r\nexport const DEFAULT_SETTINGS: Omit<\r\n  AppSettings,\r\n  'id' | 'created_at' | 'updated_at'\r\n> = {\r\n  rounded_layout: true,\r\n  theme: 'system',\r\n  brand_color: 'yellow',\r\n}\r\n\r\nclass SettingsService {\r\n  /**\r\n   * Get the current app settings\r\n   * Returns default settings if Supabase is not configured or no settings exist\r\n   */\r\n  async getSettings(): Promise<AppSettings | null> {\r\n    const supabase = getSupabaseClientForOperation('read')\r\n    if (!supabase) {\r\n      console.log('[SettingsService] Supabase not configured, using defaults')\r\n      return null\r\n    }\r\n\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('app_settings')\r\n        .select('*')\r\n        .limit(1)\r\n        .single()\r\n\r\n      if (error) {\r\n        // PGRST116 means no rows found - this is expected on first run\r\n        if (error.code === 'PGRST116') {\r\n          console.log('[SettingsService] No settings found, will use defaults')\r\n          return null\r\n        }\r\n        console.error('[SettingsService] Error fetching settings:', error)\r\n        return null\r\n      }\r\n\r\n      return data as AppSettings\r\n    } catch (err) {\r\n      console.error('[SettingsService] Unexpected error:', err)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update app settings\r\n   * Creates settings row if it doesn't exist\r\n   */\r\n  async updateSettings(\r\n    updates: AppSettingsUpdate\r\n  ): Promise<AppSettings | null> {\r\n    const supabase = getSupabaseClientForOperation('write')\r\n    if (!supabase) {\r\n      console.error('[SettingsService] Supabase not configured for writes')\r\n      return null\r\n    }\r\n\r\n    try {\r\n      // First, try to get existing settings\r\n      const { data: existing } = await supabase\r\n        .from('app_settings')\r\n        .select('id')\r\n        .limit(1)\r\n        .single()\r\n\r\n      if (existing) {\r\n        // Update existing row\r\n        const { data, error } = await supabase\r\n          .from('app_settings')\r\n          .update(updates)\r\n          .eq('id', existing.id)\r\n          .select()\r\n          .single()\r\n\r\n        if (error) {\r\n          console.error('[SettingsService] Error updating settings:', error)\r\n          return null\r\n        }\r\n\r\n        return data as AppSettings\r\n      } else {\r\n        // Insert new row with defaults + updates\r\n        const { data, error } = await supabase\r\n          .from('app_settings')\r\n          .insert({ ...DEFAULT_SETTINGS, ...updates })\r\n          .select()\r\n          .single()\r\n\r\n        if (error) {\r\n          console.error('[SettingsService] Error creating settings:', error)\r\n          return null\r\n        }\r\n\r\n        return data as AppSettings\r\n      }\r\n    } catch (err) {\r\n      console.error('[SettingsService] Unexpected error:', err)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize settings if they don't exist\r\n   */\r\n  async initializeSettings(): Promise<AppSettings | null> {\r\n    const existing = await this.getSettings()\r\n    if (existing) return existing\r\n\r\n    return this.updateSettings(DEFAULT_SETTINGS)\r\n  }\r\n}\r\n\r\nexport const settingsService = new SettingsService()\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;;AAgBO,MAAM,mBAGT;IACF,gBAAgB;IAChB,OAAO;IACP,aAAa;AACf;AAEA,MAAM;IACJ;;;GAGC,GACD,MAAM,cAA2C;QAC/C,MAAM,WAAW,IAAA,4JAA6B,EAAC;QAC/C,IAAI,CAAC,UAAU;YACb,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;QAEA,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,gBACL,MAAM,CAAC,KACP,KAAK,CAAC,GACN,MAAM;YAET,IAAI,OAAO;gBACT,+DAA+D;gBAC/D,IAAI,MAAM,IAAI,KAAK,YAAY;oBAC7B,QAAQ,GAAG,CAAC;oBACZ,OAAO;gBACT;gBACA,QAAQ,KAAK,CAAC,8CAA8C;gBAC5D,OAAO;YACT;YAEA,OAAO;QACT,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,uCAAuC;YACrD,OAAO;QACT;IACF;IAEA;;;GAGC,GACD,MAAM,eACJ,OAA0B,EACG;QAC7B,MAAM,WAAW,IAAA,4JAA6B,EAAC;QAC/C,IAAI,CAAC,UAAU;YACb,QAAQ,KAAK,CAAC;YACd,OAAO;QACT;QAEA,IAAI;YACF,sCAAsC;YACtC,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,gBACL,MAAM,CAAC,MACP,KAAK,CAAC,GACN,MAAM;YAET,IAAI,UAAU;gBACZ,sBAAsB;gBACtB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,gBACL,MAAM,CAAC,SACP,EAAE,CAAC,MAAM,SAAS,EAAE,EACpB,MAAM,GACN,MAAM;gBAET,IAAI,OAAO;oBACT,QAAQ,KAAK,CAAC,8CAA8C;oBAC5D,OAAO;gBACT;gBAEA,OAAO;YACT,OAAO;gBACL,yCAAyC;gBACzC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,gBACL,MAAM,CAAC;oBAAE,GAAG,gBAAgB;oBAAE,GAAG,OAAO;gBAAC,GACzC,MAAM,GACN,MAAM;gBAET,IAAI,OAAO;oBACT,QAAQ,KAAK,CAAC,8CAA8C;oBAC5D,OAAO;gBACT;gBAEA,OAAO;YACT;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,uCAAuC;YACrD,OAAO;QACT;IACF;IAEA;;GAEC,GACD,MAAM,qBAAkD;QACtD,MAAM,WAAW,MAAM,IAAI,CAAC,WAAW;QACvC,IAAI,UAAU,OAAO;QAErB,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B;AACF;AAEO,MAAM,kBAAkB,IAAI"}},
    {"offset": {"line": 236, "column": 0}, "map": {"version":3,"sources":["file:///D:/documents/dev/petehome/apps/web/app/api/settings/route.ts"],"sourcesContent":["/**\r\n * Settings API Routes\r\n * GET - Fetch current app settings\r\n * PUT - Update app settings\r\n */\r\n\r\nimport {\r\n  DEFAULT_SETTINGS,\r\n  settingsService,\r\n} from '@/lib/services/settings.service'\r\nimport { NextResponse } from 'next/server'\r\n\r\nexport async function GET() {\r\n  try {\r\n    const settings = await settingsService.getSettings()\r\n\r\n    if (!settings) {\r\n      // Return default settings when DB not available\r\n      return NextResponse.json({\r\n        ...DEFAULT_SETTINGS,\r\n        id: 'default',\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n    }\r\n\r\n    return NextResponse.json(settings)\r\n  } catch (error) {\r\n    console.error('[Settings API] GET error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch settings' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function PUT(request: Request) {\r\n  try {\r\n    const body = await request.json()\r\n\r\n    // Validate the update payload\r\n    const allowedKeys = ['rounded_layout', 'theme', 'brand_color']\r\n    const updates: Record<string, unknown> = {}\r\n\r\n    for (const key of allowedKeys) {\r\n      if (key in body) {\r\n        updates[key] = body[key]\r\n      }\r\n    }\r\n\r\n    if (Object.keys(updates).length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'No valid settings to update' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Validate values\r\n    if (\r\n      'rounded_layout' in updates &&\r\n      typeof updates.rounded_layout !== 'boolean'\r\n    ) {\r\n      return NextResponse.json(\r\n        { error: 'rounded_layout must be a boolean' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    if (\r\n      'theme' in updates &&\r\n      !['light', 'dark', 'system'].includes(updates.theme as string)\r\n    ) {\r\n      return NextResponse.json(\r\n        { error: 'theme must be one of: light, dark, system' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    if (\r\n      'brand_color' in updates &&\r\n      !['purple', 'blue', 'teal', 'orange', 'pink', 'yellow'].includes(\r\n        updates.brand_color as string\r\n      )\r\n    ) {\r\n      return NextResponse.json(\r\n        {\r\n          error:\r\n            'brand_color must be one of: purple, blue, teal, orange, pink, yellow',\r\n        },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const settings = await settingsService.updateSettings(updates)\r\n\r\n    if (!settings) {\r\n      return NextResponse.json(\r\n        { error: 'Failed to update settings' },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    return NextResponse.json(settings)\r\n  } catch (error) {\r\n    console.error('[Settings API] PUT error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to update settings' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;CAIC,GAED;AAIA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,2JAAe,CAAC,WAAW;QAElD,IAAI,CAAC,UAAU;YACb,gDAAgD;YAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,GAAG,4JAAgB;gBACnB,IAAI;gBACJ,YAAY,IAAI,OAAO,WAAW;gBAClC,YAAY,IAAI,OAAO,WAAW;YACpC;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,8BAA8B;QAC9B,MAAM,cAAc;YAAC;YAAkB;YAAS;SAAc;QAC9D,MAAM,UAAmC,CAAC;QAE1C,KAAK,MAAM,OAAO,YAAa;YAC7B,IAAI,OAAO,MAAM;gBACf,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI;YAC1B;QACF;QAEA,IAAI,OAAO,IAAI,CAAC,SAAS,MAAM,KAAK,GAAG;YACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,IACE,oBAAoB,WACpB,OAAO,QAAQ,cAAc,KAAK,WAClC;YACA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmC,GAC5C;gBAAE,QAAQ;YAAI;QAElB;QAEA,IACE,WAAW,WACX,CAAC;YAAC;YAAS;YAAQ;SAAS,CAAC,QAAQ,CAAC,QAAQ,KAAK,GACnD;YACA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4C,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,IACE,iBAAiB,WACjB,CAAC;YAAC;YAAU;YAAQ;YAAQ;YAAU;YAAQ;SAAS,CAAC,QAAQ,CAC9D,QAAQ,WAAW,GAErB;YACA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OACE;YACJ,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,MAAM,2JAAe,CAAC,cAAc,CAAC;QAEtD,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}