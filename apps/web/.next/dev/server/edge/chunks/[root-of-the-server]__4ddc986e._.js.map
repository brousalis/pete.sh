{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/middleware.ts"],"sourcesContent":["import type { NextRequest } from 'next/server'\r\nimport { NextResponse } from 'next/server'\r\n\r\n/**\r\n * Middleware to handle CORS for API routes\r\n *\r\n * This allows the production site (pete.sh) to make requests to the local\r\n * development server when the user is at home with local services available.\r\n */\r\n\r\n// Allowed origins for CORS\r\nconst ALLOWED_ORIGINS = [\r\n  'https://pete.sh',\r\n  'https://www.pete.sh',\r\n  'http://localhost:3000',\r\n  'http://127.0.0.1:3000',\r\n]\r\n\r\nexport function middleware(request: NextRequest) {\r\n  // Redirect legacy /dashboard to root\r\n  if (\r\n    request.nextUrl.pathname === '/dashboard' ||\r\n    request.nextUrl.pathname === '/dashboard/'\r\n  ) {\r\n    return NextResponse.redirect(new URL('/', request.url))\r\n  }\r\n\r\n  // Only handle API routes\r\n  if (!request.nextUrl.pathname.startsWith('/api/')) {\r\n    return NextResponse.next()\r\n  }\r\n\r\n  const origin = request.headers.get('origin')\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    const response = new NextResponse(null, { status: 204 })\r\n\r\n    // Set CORS headers\r\n    if (origin && ALLOWED_ORIGINS.includes(origin)) {\r\n      response.headers.set('Access-Control-Allow-Origin', origin)\r\n    } else {\r\n      // Allow any origin for local development flexibility\r\n      response.headers.set('Access-Control-Allow-Origin', '*')\r\n    }\r\n\r\n    response.headers.set(\r\n      'Access-Control-Allow-Methods',\r\n      'GET, POST, PUT, PATCH, DELETE, OPTIONS'\r\n    )\r\n    response.headers.set(\r\n      'Access-Control-Allow-Headers',\r\n      'Content-Type, Authorization, X-Requested-With'\r\n    )\r\n    response.headers.set('Access-Control-Max-Age', '86400') // 24 hours\r\n\r\n    return response\r\n  }\r\n\r\n  // For actual requests, let them proceed but add CORS headers to response\r\n  const response = NextResponse.next()\r\n\r\n  // Set CORS headers\r\n  if (origin && ALLOWED_ORIGINS.includes(origin)) {\r\n    response.headers.set('Access-Control-Allow-Origin', origin)\r\n  } else {\r\n    // Allow any origin for flexibility (the API routes themselves should handle auth)\r\n    response.headers.set('Access-Control-Allow-Origin', '*')\r\n  }\r\n\r\n  response.headers.set(\r\n    'Access-Control-Allow-Methods',\r\n    'GET, POST, PUT, PATCH, DELETE, OPTIONS'\r\n  )\r\n  response.headers.set(\r\n    'Access-Control-Allow-Headers',\r\n    'Content-Type, Authorization, X-Requested-With'\r\n  )\r\n\r\n  return response\r\n}\r\n\r\n// Configure which paths the middleware runs on\r\nexport const config = {\r\n  matcher: ['/dashboard', '/dashboard/', '/api/:path*'],\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;AAAA;;AAEA;;;;;CAKC,GAED,2BAA2B;AAC3B,MAAM,kBAAkB;IACtB;IACA;IACA;IACA;CACD;AAEM,SAAS,WAAW,OAAoB;IAC7C,qCAAqC;IACrC,IACE,QAAQ,OAAO,CAAC,QAAQ,KAAK,gBAC7B,QAAQ,OAAO,CAAC,QAAQ,KAAK,eAC7B;QACA,OAAO,+MAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,yBAAyB;IACzB,IAAI,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,UAAU;QACjD,OAAO,+MAAY,CAAC,IAAI;IAC1B;IAEA,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEnC,oCAAoC;IACpC,IAAI,QAAQ,MAAM,KAAK,WAAW;QAChC,MAAM,WAAW,IAAI,+MAAY,CAAC,MAAM;YAAE,QAAQ;QAAI;QAEtD,mBAAmB;QACnB,IAAI,UAAU,gBAAgB,QAAQ,CAAC,SAAS;YAC9C,SAAS,OAAO,CAAC,GAAG,CAAC,+BAA+B;QACtD,OAAO;YACL,qDAAqD;YACrD,SAAS,OAAO,CAAC,GAAG,CAAC,+BAA+B;QACtD;QAEA,SAAS,OAAO,CAAC,GAAG,CAClB,gCACA;QAEF,SAAS,OAAO,CAAC,GAAG,CAClB,gCACA;QAEF,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B,UAAS,WAAW;QAEnE,OAAO;IACT;IAEA,yEAAyE;IACzE,MAAM,WAAW,+MAAY,CAAC,IAAI;IAElC,mBAAmB;IACnB,IAAI,UAAU,gBAAgB,QAAQ,CAAC,SAAS;QAC9C,SAAS,OAAO,CAAC,GAAG,CAAC,+BAA+B;IACtD,OAAO;QACL,kFAAkF;QAClF,SAAS,OAAO,CAAC,GAAG,CAAC,+BAA+B;IACtD;IAEA,SAAS,OAAO,CAAC,GAAG,CAClB,gCACA;IAEF,SAAS,OAAO,CAAC,GAAG,CAClB,gCACA;IAGF,OAAO;AACT;AAGO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAc;QAAe;KAAc;AACvD"}}]
}